var t="INUMBER",e="IVAR",r="IEXPR";function s(t,e){this.type=t,this.value=null!=e?e:0}function n(t){return new s("IOP1",t)}function i(t){return new s("IOP2",t)}function o(t){return new s("IOP3",t)}function a(n,i,o,p,h){for(var u,c,f,l,v=[],y=[],x=0;x<n.length;x++){var E=n[x],M=E.type;if(M===t||"IVARNAME"===M)Array.isArray(E.value)?v.push.apply(v,a(E.value.map((function(e){return new s(t,e)})).concat(new s("IARRAY",E.value.length)),i,o,p,h)):v.push(E);else if(M===e&&h.hasOwnProperty(E.value))E=new s(t,h[E.value]),v.push(E);else if("IOP2"===M&&v.length>1)c=v.pop(),u=v.pop(),l=o[E.value],E=new s(t,l(u.value,c.value)),v.push(E);else if("IOP3"===M&&v.length>2)f=v.pop(),c=v.pop(),u=v.pop(),"?"===E.value?v.push(u.value?c.value:f.value):(l=p[E.value],E=new s(t,l(u.value,c.value,f.value)),v.push(E));else if("IOP1"===M&&v.length>0)u=v.pop(),l=i[E.value],E=new s(t,l(u.value)),v.push(E);else if(M===r){for(;v.length>0;)y.push(v.shift());y.push(new s(r,a(E.value,i,o,p,h)))}else if("IMEMBER"===M&&v.length>0)u=v.pop(),v.push(new s(t,u.value[E.value]));else{for(;v.length>0;)y.push(v.shift());y.push(E)}}for(;v.length>0;)y.push(v.shift());return y}function p(t,a,h){for(var u=[],c=0;c<t.length;c++){var f=t[c],l=f.type;if(l===e&&f.value===a)for(var v=0;v<h.tokens.length;v++){var y,x=h.tokens[v];y="IOP1"===x.type?n(x.value):"IOP2"===x.type?i(x.value):"IOP3"===x.type?o(x.value):new s(x.type,x.value),u.push(y)}else l===r?u.push(new s(r,p(f.value,a,h))):u.push(f)}return u}function h(s,n,i){var o,a,p,l,v,y,x=[];if(c(s))return f(s,i);for(var E=s.length,M=0;M<E;M++){var w=s[M],A=w.type;if(A===t||"IVARNAME"===A)x.push(w.value);else if("IOP2"===A)a=x.pop(),o=x.pop(),"and"===w.value?x.push(!!o&&!!h(a,n,i)):"or"===w.value?x.push(!!o||!!h(a,n,i)):"="===w.value?(l=n.binaryOps[w.value],x.push(l(o,h(a,n,i),i))):(l=n.binaryOps[w.value],x.push(l(f(o,i),f(a,i))));else if("IOP3"===A)p=x.pop(),a=x.pop(),o=x.pop(),"?"===w.value?x.push(h(o?a:p,n,i)):(l=n.ternaryOps[w.value],x.push(l(f(o,i),f(a,i),f(p,i))));else if(A===e)if(w.value in n.functions)x.push(n.functions[w.value]);else if(w.value in n.unaryOps&&n.parser.isOperatorEnabled(w.value))x.push(n.unaryOps[w.value]);else{var g=i[w.value];if(void 0===g)throw new Error("undefined variable: "+w.value);x.push(g)}else if("IOP1"===A)o=x.pop(),l=n.unaryOps[w.value],x.push(l(f(o,i)));else if("IFUNCALL"===A){for(y=w.value,v=[];y-- >0;)v.unshift(f(x.pop(),i));if(!(l=x.pop()).apply||!l.call)throw new Error(l+" is not a function");x.push(l.apply(void 0,v))}else if("IFUNDEF"===A)x.push(function(){for(var t=x.pop(),e=[],r=w.value;r-- >0;)e.unshift(x.pop());var s=x.pop(),o=function(){for(var r=Object.assign({},i),s=0,o=e.length;s<o;s++)r[e[s]]=arguments[s];return h(t,n,r)};return Object.defineProperty(o,"name",{value:s,writable:!1}),i[s]=o,o}());else if(A===r)x.push(u(w,n));else if("IEXPREVAL"===A)x.push(w);else if("IMEMBER"===A)o=x.pop(),x.push(o[w.value]);else if("IENDSTATEMENT"===A)x.pop();else{if("IARRAY"!==A)throw new Error("invalid Expression");for(y=w.value,v=[];y-- >0;)v.unshift(x.pop());x.push(v)}}if(x.length>1)throw new Error("invalid Expression (parity)");return 0===x[0]?0:f(x[0],i)}function u(t,e,r){return c(t)?t:{type:"IEXPREVAL",value:function(r){return h(t.value,e,r)}}}function c(t){return t&&"IEXPREVAL"===t.type}function f(t,e){return c(t)?t.value(e):t}function l(s,n){for(var i,o,a,p,h,u,c=[],f=0;f<s.length;f++){var y=s[f],x=y.type;if(x===t)"number"==typeof y.value&&y.value<0?c.push("("+y.value+")"):Array.isArray(y.value)?c.push("["+y.value.map(v).join(", ")+"]"):c.push(v(y.value));else if("IOP2"===x)o=c.pop(),i=c.pop(),p=y.value,n?"^"===p?c.push("Math.pow("+i+", "+o+")"):"and"===p?c.push("(!!"+i+" && !!"+o+")"):"or"===p?c.push("(!!"+i+" || !!"+o+")"):"||"===p?c.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+i+"),("+o+")))"):"=="===p?c.push("("+i+" === "+o+")"):"!="===p?c.push("("+i+" !== "+o+")"):"["===p?c.push(i+"[("+o+") | 0]"):c.push("("+i+" "+p+" "+o+")"):"["===p?c.push(i+"["+o+"]"):c.push("("+i+" "+p+" "+o+")");else if("IOP3"===x){if(a=c.pop(),o=c.pop(),i=c.pop(),"?"!==(p=y.value))throw new Error("invalid Expression");c.push("("+i+" ? "+o+" : "+a+")")}else if(x===e||"IVARNAME"===x)c.push(y.value);else if("IOP1"===x)i=c.pop(),"-"===(p=y.value)||"+"===p?c.push("("+p+i+")"):n?"not"===p?c.push("(!"+i+")"):"!"===p?c.push("fac("+i+")"):c.push(p+"("+i+")"):"!"===p?c.push("("+i+"!)"):c.push("("+p+" "+i+")");else if("IFUNCALL"===x){for(u=y.value,h=[];u-- >0;)h.unshift(c.pop());p=c.pop(),c.push(p+"("+h.join(", ")+")")}else if("IFUNDEF"===x){for(o=c.pop(),u=y.value,h=[];u-- >0;)h.unshift(c.pop());i=c.pop(),n?c.push("("+i+" = function("+h.join(", ")+") { return "+o+" })"):c.push("("+i+"("+h.join(", ")+") = "+o+")")}else if("IMEMBER"===x)i=c.pop(),c.push(i+"."+y.value);else if("IARRAY"===x){for(u=y.value,h=[];u-- >0;)h.unshift(c.pop());c.push("["+h.join(", ")+"]")}else if(x===r)c.push("("+l(y.value,n)+")");else if("IENDSTATEMENT"!==x)throw new Error("invalid Expression")}return c.length>1&&(c=n?[c.join(",")]:[c.join(";")]),String(c[0])}function v(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function y(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function x(t,s,n){for(var i=!!(n=n||{}).withMembers,o=null,a=0;a<t.length;a++){var p=t[a];p.type===e||"IVARNAME"===p.type?i||y(s,p.value)?null!==o?(y(s,o)||s.push(o),o=p.value):o=p.value:s.push(p.value):"IMEMBER"===p.type&&i&&null!==o?o+="."+p.value:p.type===r?x(p.value,s,n):null!==o&&(y(s,o)||s.push(o),o=null)}null===o||y(s,o)||s.push(o)}function E(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}s.prototype.toString=function(){switch(this.type){case t:case"IOP1":case"IOP2":case"IOP3":case e:case"IVARNAME":case"IENDSTATEMENT":return this.value;case"IFUNCALL":return"CALL "+this.value;case"IFUNDEF":return"DEF "+this.value;case"IARRAY":return"ARRAY "+this.value;case"IMEMBER":return"."+this.value;default:return"Invalid Instruction"}},E.prototype.simplify=function(t){return t=t||{},new E(a(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)},E.prototype.substitute=function(t,e){return e instanceof E||(e=this.parser.parse(String(e))),new E(p(this.tokens,t,e),this.parser)},E.prototype.evaluate=function(t){return t=t||{},h(this.tokens,this,t)},E.prototype.toString=function(){return l(this.tokens,!1)},E.prototype.symbols=function(t){t=t||{};var e=[];return x(this.tokens,e,t),e},E.prototype.variables=function(t){t=t||{};var e=[];x(this.tokens,e,t);var r=this.functions;return e.filter((function(t){return!(t in r)}))},E.prototype.toJSFunction=function(t,e){var r=this,s=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+l(this.simplify(e).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var M="TOP",w="TPAREN";function A(t,e,r){this.type=t,this.value=e,this.index=r}function g(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}A.prototype.toString=function(){return this.type+": "+this.value},g.prototype.newToken=function(t,e,r){return new A(t,e,null!=r?r:this.pos)},g.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},g.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},g.prototype.next=function(){return this.pos>=this.expression.length?this.newToken("TEOF","EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},g.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var s=this.expression.indexOf(r,e+1);s>=0&&this.pos<this.expression.length;){if(this.pos=s+1,"\\"!==this.expression.charAt(s-1)){var n=this.expression.substring(e+1,s);this.current=this.newToken("TSTRING",this.unescape(n),e),t=!0;break}s=this.expression.indexOf(r,s+1)}return t},g.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(w,t),this.pos++,!0)},g.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("["))&&(this.current=this.newToken("TBRACKET",t),this.pos++,!0)},g.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken("TCOMMA",","),this.pos++,!0)},g.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken("TSEMICOLON",";"),this.pos++,!0)},g.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(s in this.consts)return this.current=this.newToken("TNUMBER",this.consts[s]),this.pos+=s.length,!0}return!1},g.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||r>"9")))break}if(e>t){var s=this.expression.substring(t,e);if(this.isOperatorEnabled(s)&&(s in this.binaryOps||s in this.unaryOps||s in this.ternaryOps))return this.current=this.newToken(M,s),this.pos+=s.length,!0}return!1},g.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase()){if(e===this.pos&&("$"===s||"_"===s)){"_"===s&&(r=!0);continue}if(e===this.pos||!r||"_"!==s&&(s<"0"||s>"9"))break}else r=!0}if(r){var n=this.expression.substring(t,e);return this.current=this.newToken("TNAME",n),this.pos+=n.length,!0}return!1},g.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var d=/^[0-9a-f]{4}$/i;function O(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}g.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var s=t.charAt(++e);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var n=t.substring(e+1,e+5);d.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++e;var i=t.indexOf("\\",e);r+=t.substring(e,i<0?t.length:i),e=i}return r},g.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},g.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if(++r,"x"===this.expression.charAt(r))t=16,e=/^[0-9a-f]$/i,++r;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i,++r}for(var s=!1,n=r;r<this.expression.length;){var i=this.expression.charAt(r);if(!e.test(i))break;r++,s=!0}return s&&(this.current=this.newToken("TNUMBER",parseInt(this.expression.substring(n,r),t)),this.pos=r),s},g.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,s=r,n=r,i=!1,o=!1;r<this.expression.length&&((t=this.expression.charAt(r))>="0"&&t<="9"||!i&&"."===t);)"."===t?i=!0:o=!0,r++,e=o;if(e&&(n=r),"e"===t||"E"===t){r++;for(var a=!0,p=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!a||"+"!==t&&"-"!==t){if(!(t>="0"&&t<="9"))break;p=!0,a=!1}else a=!1;r++}p||(r=n)}return e?(this.current=this.newToken("TNUMBER",parseFloat(this.expression.substring(s,r))),this.pos=r):this.pos=n,e},g.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(M,e);else if("∙"===e||"•"===e)this.current=this.newToken(M,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(M,">="),this.pos++):this.current=this.newToken(M,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(M,"<="),this.pos++):this.current=this.newToken(M,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(M,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(M,"=="),this.pos++):this.current=this.newToken(M,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(M,"!="),this.pos++):this.current=this.newToken(M,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},g.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},g.prototype.getCoordinates=function(){var t,e=0,r=-1;do{e++,t=this.pos-r,r=this.expression.indexOf("\n",r+1)}while(r>=0&&r<this.pos);return{line:e,column:t}},g.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},O.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},O.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?y(e,t.value):"function"==typeof e?e(t):t.value===e)},O.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},O.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},O.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e))&&(this.next(),!0)},O.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}},O.prototype.parseAtom=function(r){var n=this.tokens.unaryOps;if(this.accept("TNAME")||this.accept(M,(function(t){return t.value in n})))r.push(new s(e,this.current.value));else if(this.accept("TNUMBER"))r.push(new s(t,this.current.value));else if(this.accept("TSTRING"))r.push(new s(t,this.current.value));else if(this.accept(w,"("))this.parseExpression(r),this.expect(w,")");else{if(!this.accept("TBRACKET","["))throw new Error("unexpected "+this.nextToken);if(this.accept("TBRACKET","]"))r.push(new s("IARRAY",0));else{var i=this.parseArrayList(r);r.push(new s("IARRAY",i))}}},O.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e)||this.pushExpression(t,e))},O.prototype.pushExpression=function(t,e){for(var r=0,s=e.length;r<s;r++)t.push(e[r])},O.prototype.parseUntilEndStatement=function(t,e){return!!this.accept("TSEMICOLON")&&(!this.nextToken||"TEOF"===this.nextToken.type||this.nextToken.type===w&&")"===this.nextToken.value||e.push(new s("IENDSTATEMENT")),"TEOF"!==this.nextToken.type&&this.parseExpression(e),t.push(new s(r,e)),!0)},O.prototype.parseArrayList=function(t){for(var e=0;!this.accept("TBRACKET","]");)for(this.parseExpression(t),++e;this.accept("TCOMMA");)this.parseExpression(t),++e;return e},O.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(M,"=");){var n=t.pop(),o=[],a=t.length-1;if("IFUNCALL"!==n.type){if(n.type!==e&&"IMEMBER"!==n.type)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(o),t.push(new s("IVARNAME",n.value)),t.push(new s(r,o)),t.push(i("="))}else{if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var p=0,h=n.value+1;p<h;p++){var u=a-p;t[u].type===e&&(t[u]=new s("IVARNAME",t[u].value))}this.parseVariableAssignmentExpression(o),t.push(new s(r,o)),t.push(new s("IFUNDEF",n.value))}}},O.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(M,"?");){var e=[],n=[];this.parseConditionalExpression(e),this.expect(M,":"),this.parseConditionalExpression(n),t.push(new s(r,e)),t.push(new s(r,n)),t.push(o("?"))}},O.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(M,"or");){var e=[];this.parseAndExpression(e),t.push(new s(r,e)),t.push(i("or"))}},O.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(M,"and");){var e=[];this.parseComparison(e),t.push(new s(r,e)),t.push(i("and"))}};var T=["==","!=","<","<=",">=",">","in"];O.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(M,T);){var e=this.current;this.parseAddSub(t),t.push(i(e.value))}};var m=["+","-","||"];O.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(M,m);){var e=this.current;this.parseTerm(t),t.push(i(e.value))}};var b=["*","/","%"];function k(t,e){return Number(t)+Number(e)}function I(t,e){return t-e}function N(t,e){return t*e}function C(t,e){return t/e}function R(t,e){return t%e}function P(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function F(t,e){return t===e}function S(t,e){return t!==e}function L(t,e){return t>e}function B(t,e){return t<e}function U(t,e){return t>=e}function V(t,e){return t<=e}function j(t,e){return Boolean(t&&e)}function q(t,e){return Boolean(t||e)}function D(t,e){return y(e,t)}function Y(t){return(Math.exp(t)-Math.exp(-t))/2}function K(t){return(Math.exp(t)+Math.exp(-t))/2}function _(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function X(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function $(t){return Math.log(t+Math.sqrt(t*t-1))}function G(t){return Math.log((1+t)/(1-t))/2}function J(t){return Math.log(t)*Math.LOG10E}function W(t){return-t}function z(t){return!t}function H(t){return t<0?Math.ceil(t):Math.floor(t)}function Q(t){return Math.random()*(t||1)}function Z(t){return et(t+1)}O.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(M,b);){var e=this.current;this.parseFactor(t),t.push(i(e.value))}},O.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(M,(function(t){return t.value in e}))){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===w&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if("TSEMICOLON"===this.nextToken.type||"TCOMMA"===this.nextToken.type||"TEOF"===this.nextToken.type||this.nextToken.type===w&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(n(r.value))}else this.parseExponential(t)},O.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(M,"^");)this.parseFactor(t),t.push(i("^"))},O.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(M,"!");)t.push(n("!"))},O.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;if(this.accept(M,(function(t){return t.value in e}))){var r=this.current;this.parseAtom(t),t.push(n(r.value))}else for(this.parseMemberExpression(t);this.accept(w,"(");)if(this.accept(w,")"))t.push(new s("IFUNCALL",0));else{var i=this.parseArgumentList(t);t.push(new s("IFUNCALL",i))}},O.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(w,")");)for(this.parseExpression(t),++e;this.accept("TCOMMA");)this.parseExpression(t),++e;return e},O.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(M,".")||this.accept("TBRACKET","[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect("TNAME"),t.push(new s("IMEMBER",this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect("TBRACKET","]"),t.push(i("["))}}};var tt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function et(t){var e,r;if(function(t){return isFinite(t)&&t===Math.round(t)}(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var s=t-2,n=t-1;s>1;)n*=s,s--;return 0===n&&(n=1),n}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*et(1-t));if(t>=171.35)return 1/0;if(t>85){var i=t*t,o=i*t,a=o*t,p=a*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*i)-139/(51840*o)-571/(2488320*a)+163879/(209018880*p)+5246819/(75246796800*p*t))}--t,r=tt[0];for(var h=1;h<tt.length;++h)r+=tt[h]/(t+h);return e=t+4.7421875+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function rt(t){return Array.isArray(t)?t.length:String(t).length}function st(){for(var t=0,e=0,r=0;r<arguments.length;r++){var s,n=Math.abs(arguments[r]);e<n?(t=t*(s=e/n)*s+1,e=n):t+=n>0?(s=n/e)*s:n}return e===1/0?1/0:e*Math.sqrt(t)}function nt(t,e,r){return t?e:r}function it(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function ot(t,e,r){return r&&(r[t]=e),e}function at(t,e){return t[0|e]}function pt(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function ht(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function ut(t,e){if("function"!=typeof t)throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map((function(e,r){return t(e,r)}))}function ct(t,e,r){if("function"!=typeof t)throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce((function(e,r,s){return t(e,r,s)}),e)}function ft(t,e){if("function"!=typeof t)throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter((function(e,r){return t(e,r)}))}function lt(t,e){if(!Array.isArray(e)&&"string"!=typeof e)throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function vt(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function yt(t){return(t>0)-(t<0)||+t}function xt(t){return t<0?-Math.pow(-t,.3333333333333333):Math.pow(t,.3333333333333333)}function Et(t){return Math.exp(t)-1}function Mt(t){return Math.log(1+t)}function wt(t){return Math.log(t)/Math.LN2}function At(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||Y,cosh:Math.cosh||K,tanh:Math.tanh||_,asinh:Math.asinh||X,acosh:Math.acosh||$,atanh:Math.atanh||G,sqrt:Math.sqrt,cbrt:Math.cbrt||xt,log:Math.log,log2:Math.log2||wt,ln:Math.log,lg:Math.log10||J,log10:Math.log10||J,expm1:Math.expm1||Et,log1p:Math.log1p||Mt,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||H,"-":W,"+":Number,exp:Math.exp,not:z,length:rt,"!":Z,sign:Math.sign||yt},this.binaryOps={"+":k,"-":I,"*":N,"/":C,"%":R,"^":Math.pow,"||":P,"==":F,"!=":S,">":L,"<":B,">=":U,"<=":V,and:j,or:q,in:D,"=":ot,"[":at},this.ternaryOps={"?":nt},this.functions={random:Q,fac:Z,min:ht,max:pt,hypot:Math.hypot||st,pyt:Math.hypot||st,pow:Math.pow,atan2:Math.atan2,if:nt,gamma:et,roundTo:it,map:ut,fold:ct,filter:ft,indexOf:lt,join:vt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}At.prototype.parse=function(t){var e=[],r=new O(this,new g(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect("TEOF","EOF"),new E(e,this)},At.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var gt=new At;At.parse=function(t){return gt.parse(t)},At.evaluate=function(t,e){return gt.parse(t).evaluate(e)};var dt={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};At.prototype.isOperatorEnabled=function(t){var e=function(t){return dt.hasOwnProperty(t)?dt[t]:t}(t),r=this.options.operators||{};return!(e in r)||!!r[e]};
/*!
 Based on ndef.parser, by Raphael Graf(r@undefined.ch)
 http://www.undefined.ch/mparser/index.html

 Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)

 You are free to use and modify this code in anyway you find useful. Please leave this comment in the code
 to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,
 but don't feel like you have to let me know or ask permission.
*/
var Ot={Parser:At,Expression:E};export default Ot;export{E as Expression,At as Parser};
