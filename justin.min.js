let e,r,t=t=>(e=0,r=t,t=s(),r[e]?n():t||""),n=(t="Bad syntax",n=r[e],a=r.slice(0,e).split("\n"),s=a.pop())=>{throw SyntaxError(`${t} \`${n}\` at ${a.length}:${s.length}`)},a=(t=1,n=e,a)=>{if("number"==typeof t)e+=t;else for(;a=t(r.charCodeAt(e));)e+=a;return r.slice(n,e)},s=(r=0,a,s,l,o,c)=>{for(;(s=t.space())&&(o=((c=i[s])&&c(l,r))??(!l&&t.id()));)l=o;return a&&(s==a?e++:n()),l},l=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e;t.space=t=>{for(;(t=r.charCodeAt(e))<=32;)e++;return t},t.id=e=>a(l);let i=[];t.set=(t,n=32,a,s=t.charCodeAt(0),o=t.length,c=i[s],p=t.toUpperCase()!==t)=>i[s]=(s,i,h=e)=>i<n&&(o<2||r.substr(e,o)==t)&&(!p||!l(r.charCodeAt(e+o)))&&(e+=o,a(s,i))||(e=h,c?.(s,i)),t.binary=(e,r,n)=>t.set(e,r,((t,a)=>t&&(a=s(r-!!n))&&[e,t,a])),t.unary=(e,r,n)=>t.set(e,r,(t=>!t&&(t=s(r-1))&&[e,t])),t.nary=(e,r)=>t.set(e,r,((t,n)=>t&&(n=s(r))&&(t[0]===e&&t[2]?(t.push(n),t):[e,t,n])));const o=e=>Array.isArray(e)?c[e[0]](...e.slice(1)):r=>r?.[e],c={};o.set=(e,r,t=c[e])=>c[e]=(...e)=>r(...e)||t&&t(...e),o.binary=(e,r)=>o.set(e,((e,t)=>t&&(e=o(e),t=o(t),e.length||t.length?n=>r(e(n),t(n)):(e=r(e(),t()),()=>e)))),o.unary=(e,r)=>o.set(e,((e,t)=>!t&&((e=o(e)).length?t=>r(e(t)):(e=r(e()),()=>e)))),o.nary=(e,r)=>o.set(e,((...e)=>(e=e.map(o),t=>r(...e.map((e=>e(t)))))));const p=e=>(e=t(e),r=>(e.call?e:e=o(e))(r)),h=p.set=(e,r,n)=>n[0]||n[1]?(r?t.set(e,r,n[0]):i[e.charCodeAt(0)||1]=n[0],o.set(e,n[1])):n.length?n.length>1?(t.binary(e,Math.abs(r),r<0),o.binary(e,n)):(t.unary(e,r),o.unary(e,n)):(t.nary(e,r),o.nary(e,n)),y=e=>e?n():["",(e=+a((e=>46===e||e>=48&&e<=57||(69===e||101===e?2:0))))!=e?n():e],f=(e,r,t,n)=>[e,r,[t=>t?["++"===e?"-":"+",[e,t],["",1]]:[e,s(r-1)],n=(e,r)=>"("===e[0]?n(e[1]):"."===e[0]?(r=e[2],e=o(e[1]),n=>t(e(n),r)):"["===e[0]?([,e,r]=e,e=o(e),r=o(r),n=>t(e(n),r(n))):r=>t(r,e)]],u=["",,[,e=>()=>e],'"',,[e=>e?n():["",(a()+a((e=>e-34?1:0))+(a()||n("Bad string"))).slice(1,-1)]],".",,[e=>!e&&y()],...Array(10).fill(0).flatMap(((e,r)=>[""+r,0,[y]])),",",1,(...e)=>e[e.length-1],"||",4,(...e)=>{let r,t=0;for(;!r&&t<e.length;)r=e[t++];return r},"&&",5,(...e)=>{let r=0,t=!0;for(;t&&r<e.length;)t=e[r++];return t},"+",12,(e,r)=>e+r,"-",12,(e,r)=>e-r,"*",13,(e,r)=>e*r,"/",13,(e,r)=>e/r,"%",13,(e,r)=>e%r,"|",6,(e,r)=>e|r,"&",8,(e,r)=>e&r,"^",7,(e,r)=>e^r,"==",9,(e,r)=>e==r,"!=",9,(e,r)=>e!=r,">",10,(e,r)=>e>r,">=",10,(e,r)=>e>=r,"<",10,(e,r)=>e<r,"<=",10,(e,r)=>e<=r,">>",11,(e,r)=>e>>r,">>>",11,(e,r)=>e>>>r,"<<",11,(e,r)=>e<<r,"+",15,e=>+e,"-",15,e=>-e,"!",15,e=>!e,...f("++",15,((e,r)=>++e[r])),...f("--",15,((e,r)=>--e[r])),"[",18,[e=>e&&["[",e,s(0,93)||n()],(e,r)=>r&&(e=o(e),r=o(r),t=>e(t)[r(t)])],".",18,[(e,r)=>e&&(r=s(18))&&[".",e,r],(e,r)=>(e=o(e),r=r[0]?r:r[1],t=>e(t)[r])],"(",18,[e=>!e&&["(",s(0,41)||n()],o],"(",18,[e=>e&&["(",e,s(0,41)||""],(e,r,t,n)=>null!=r&&(n=""==r?()=>[]:","===r[0]?(r=r.slice(1).map(o),e=>r.map((r=>r(e)))):(r=o(r),e=>[r(e)]),"."===e[0]?(t=e[2],e=o(e[1]),r=>e(r)[t](...n(r))):"["===e[0]?(t=o(e[2]),e=o(e[1]),r=>e(r)[t(r)](...n(r))):(e=o(e),r=>e(r)(...n(r))))]];for(;u[2];)h(...u.splice(0,3));let d={n:"\n",r:"\r",t:"\t",b:"\b",f:"\f",v:"\v"},g=t=>(s,l,i="")=>{for(s&&n("Unexpected string"),a();(l=r.charCodeAt(e))-t;)92===l?(a(),l=a(),i+=d[l]||l):i+=a();return a(),["",i]},b=["===",9,(e,r)=>e===r,"!==",9,(e,r)=>e!==r,"~",15,e=>~e,"?",3,[(e,r,t)=>e&&(r=s(2,58))&&["?",e,r,s(3)],(e,r,t)=>(e=o(e),r=o(r),t=o(t),n=>e(n)?r(n):t(n))],"??",6,(e,r)=>e??r,"?.",18,[e=>e&&["?.",e],e=>(e=o(e),r=>e(r)||(()=>{}))],"?.",18,[(e,r)=>e&&!(r=s(18))?.map&&["?.",e,r],(e,r)=>r&&(e=o(e),t=>e(t)?.[r])],"in",10,(e,r)=>e in r,'"',,[g(34)],"'",,[g(39)],"/*",20,[(t,n)=>(a((t=>42!==t&&47!==r.charCodeAt(e+1))),a(2),t||s(n))],"//",20,[(e,r)=>(a((e=>e>=32)),e||s(r))],"null",20,[e=>e?n():["",null]],"true",20,[e=>e?n():["",!0]],"false",20,[e=>e?n():["",!1]],"undefined",20,[e=>e?n():["",void 0]],";",20,[e=>s()||[""]],"**",-14,(e,r)=>e**r,"[",20,[e=>!e&&["[",s(0,93)||""],(e,r)=>!r&&(e?","===e[0]?(e=e.slice(1).map(o),r=>e.map((e=>e(r)))):(e=o(e),r=>[e(r)]):()=>[])],"{",20,[e=>!e&&["{",s(0,125)||""],(e,r)=>e?","===e[0]?(e=e.slice(1).map(o),r=>Object.fromEntries(e.map((e=>e(r))))):":"===e[0]?(e=o(e),r=>Object.fromEntries([e(r)])):(r=o(e),t=>({[e]:r(t)})):e=>({})],":",1.1,[(e,r)=>[":",e,s(1.1)||n()],(e,r)=>(r=o(r),e=Array.isArray(e)?o(e):(e=>e).bind(0,e),t=>[e(t),r(t)])]];for(;b[2];)p.set(...b.splice(0,3));export{o as compile,p as default,t as parse};