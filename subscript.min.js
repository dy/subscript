export const operators=[{"(":(...e)=>e(...args),"[":(...e)=>e.reduce(((e,r)=>e?e[r]:e)),".":(...e)=>e.reduce(((e,r)=>e?e[r]:e))},{"!":e=>!e,"+":e=>+e,"-":e=>-e,"++":e=>++e,"--":e=>--e},{"%":(...e)=>e.reduce(((e,r)=>e%r)),"/":(...e)=>e.reduce(((e,r)=>e/r)),"*":(...e)=>e.reduce(((e,r)=>e*r))},{"+":(...e)=>e.reduce(((e,r)=>e+r)),"-":(...e)=>e.reduce(((e,r)=>e-r))},{">>>":(e,r)=>e>>>r,">>":(e,r)=>e>>r,"<<":(e,r)=>e<<r},{">=":(e,r)=>e>=r,">":(e,r)=>e>r,"<=":(e,r)=>e<=r,"<":(e,r)=>e<r},{"!=":(e,r)=>e!=r,"==":(e,r)=>e==r},{"&":(e,r)=>e&r},{"^":(e,r)=>e^r},{"|":(e,r)=>e|r},{"&&":(...e)=>e.every(Boolean)},{"||":(...e)=>e.some(Boolean)},{",":(...e)=>e.reduce(((e,r)=>r))}],operator=(e,r,t,s)=>{if(e&&"string"==typeof e&&!quotes[e[0]])for(s=operators.length;s--;)if((t=operators[s][e])&&1==r?t.length==r:t)return t},literals={true:!0,false:!1,null:null,undefined:void 0},blocks={"(":")","[":"]"},quotes={'"':'"'},comments={},transforms={"(":e=>e.length<2?e[1]:e.slice(1).reduce(((e,r)=>[e].concat(r?","==r[0]?r.slice(1):[r]:[]))),".":e=>[e[0],e[1],...e.slice(2).map((e=>"string"==typeof e?`"${e}"`:e))]},transform=(e,r)=>(r=isnode(e)&&transforms[e[0]])?r(e):e,isnode=e=>Array.isArray(e)&&e.length&&e[0],space=" \r\n\t",parse=(e,r=0)=>{const t=(n,l="",a,i,p,u,c,f=[])=>{const d=e=>{""!==l&&f.push(a?parseFloat(l):l in literals?literals[l]:l),e&&f.push(e),a=l=i=""};for(;r<=e.length;l+=i)if(u=(p=(i=e[r++])+e[r])+e[r+1],!a||"e"!=i&&"E"!=i)if(space.includes(i))d();else if(c=comments[p]||comments[i])d(),s(e,c);else if(c=quotes[u]||quotes[p]||quotes[i])l=i+e.slice(r,s(e,c)),d();else if(c=blocks[i])d(i),f.push(t(c));else if(!l&&i>="0"&&i<="9"||"."==i&&e[r]>="0"&&e[r]<="9")a=1;else{if(i==n)return d(),o(f);(operator(i=u)||operator(i=p)||operator(i=i[0]))&&(r+=i.length-1,(i.toLowerCase()==i.toUpperCase()||!l&&space.includes(e[r]))&&d(i))}else i+=e[r++]},s=(e,t,s)=>r=(r=e.indexOf(t,r))<0?e.length:r+t.length,o=e=>{if(!e.length)return;let r,t,s,o,n,l,a;const i=()=>{return~s&&(e[s]=(r=e[s],(t=isnode(r)&&transforms[r[0]])?t(r):r),s=-1);var r,t};for(r of operators){for(s=-1,t=1;t<e.length;)o=e[t-2],l=e[t-1],n=e[t],a="string"==typeof l&&r[l],a&&!operator(n)&&t>1&&!operator(o)?1==r[l].length?(i(),t++):s==t-2&&o[0]==l?(o.push(n),e.splice(t-1,2)):(i(),e.splice(s=t-2,3,[l,e[s],n])):a&&!operator(n)?(e.splice(s=t-1,2,[l,n]),t--):(i(),t++);i()}return e.length>1?e:e[0]};return e=t()},evaluate=(e,r={})=>isnode(e)?(isnode(e[0])?evaluate(e[0]):"string"==typeof e[0]?r[e[0]]||operator(e[0],e.length-1):e[0])(...e.slice(1).map((e=>evaluate(e,r)))):"string"==typeof e?quotes[e[0]]?e.slice(1,-1):r[e]:e;export default e=>(e="string"==typeof e?parse(e):e,r=>evaluate(e,r));
