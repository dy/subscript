<script type="module">
  import test, {is} from '../lib/test.js'

  test('perf', async t => {
    const src = c => `(a + 2) * 3 / 2 + b * 2 - ${c}`
    const args = {a:3,b:4}

    const {Parser} = await import('../lib/expr-eval.min.js');
    console.time('expr-eval')
    let eeparser = new Parser();
    for (let i = 0; i < 1e4; i++){
      let expr = eeparser.parse(src(i));
      expr.evaluate(args);
    }
    console.timeEnd('expr-eval')
    console.time('expr-eval2')
    eeparser = new Parser();
    for (let i = 0; i < 1e4; i++){
      let expr = eeparser.parse(src(i));
      expr.evaluate(args);
    }
    console.timeEnd('expr-eval2')



    const {parse} = await import('../subscript.js');
    console.time('subscript')
    for (let i = 0; i < 1e4; i++){
      let ast = parse(src(i));
    }
    console.timeEnd('subscript')
    console.time('subscript2')
    for (let i = 0; i < 1e4; i++){
      let ast = parse(src(i));
    }
    console.timeEnd('subscript2')

    const {default:justin} = await import('../justin.js');
    console.time('justin')
    for (let i = 0; i < 1e4; i++){
      let f = justin(src(i))
      // f(args)
    }
    console.timeEnd('justin')
    console.time('justin2')
    for (let i = 0; i < 1e4; i++){
      let f = justin(src(i))
      // f(args)
    }
    console.timeEnd('justin2')


    const jsep = await import('../lib/expression-eval.module.js');
    console.time('jsep')
    for (let i = 0; i < 1e4; i++){
      let ast = jsep.parse(src(i));
      // jsep.eval(ast, args)
    }
    console.timeEnd('jsep')
    console.time('jsep2')
    for (let i = 0; i < 1e4; i++){
      let ast = jsep.parse(src(i));
      // jsep.eval(ast, args)
    }
    console.timeEnd('jsep2')


    const {Jexl} = await import('../lib/jexl.min.js');
    console.time('jexl')
    let jexl = new Jexl
    for (let i = 0; i < 1e4; i++){
      jexl.eval(src(i), args)
    }
    console.timeEnd('jexl')
    console.time('jexl2')
    jexl = new Jexl
    for (let i = 0; i < 1e4; i++){
      jexl.eval(src(i), args)
    }
    console.timeEnd('jexl2')

    const {default:sm} = await import('../lib/string-math.js');
    console.time('string-math')
    for (let i = 0; i < 1e4; i++){
      sm(`(3 + 2) * 3 / 2 + 4 * 2 - ${i}`)
    }
    console.timeEnd('string-math')
    console.time('string-math2')
    for (let i = 0; i < 1e4; i++){
      sm(`(3 + 2) * 3 / 2 + 4 * 2 - ${i}`)
    }
    console.timeEnd('string-math2')


    const {default:dislex,parse:dparse} = await import('../lib/dislex.js');
    console.time('dislex')
    for (let i = 0; i < 1e4; i++){
      let tree = dparse(src(i))
      // evaluate(tree,args)
    }
    console.timeEnd('dislex')
    console.time('dislex2')
    for (let i = 0; i < 1e4; i++){
      let tree = dparse(src(i))
      // evaluate(tree,args)
    }
    console.timeEnd('dislex2')


    console.time('new Function')
    for (let i = 0; i < 1e4; i++){
      let f = new Function('a','b', 'return '+src(i))
      f(3, 4)
    }
    console.timeEnd('new Function')
    console.time('new Function2')
    for (let i = 0; i < 1e4; i++){
      let f = new Function('a','b', 'return '+src(i))
      f(3, 4)
    }
    console.timeEnd('new Function2')


  })
</script>
