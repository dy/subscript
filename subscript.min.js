var C,n,h=r=>(C=0,n=r,r=u(),n[C]?P():r||""),P=(r="Bad syntax",o=n.slice(0,C).split(`
`),t=o.pop())=>{let e=n.slice(C-108,C).split(`
`).pop(),m=n.slice(C,C+108).split(`
`).shift();throw EvalError(`${r} at ${o.length}:${t.length} \`${C>=108?"\u2026":""}${e}\u2503${m}\``)},N=(r,o=C,t)=>{for(;t=r(n.charCodeAt(C));)C+=t;return n.slice(o,C)},B=()=>n[C++],u=(r=0,o)=>{let t,e,m,R;for(;(t=j())&&(m=((R=_[t])&&R(e,r))??(!e&&N(h.id)));)e=m;return o&&(t==o?C++:P()),e},j=r=>{for(;(r=n.charCodeAt(C))<=32;)C++;return r},nr=h.id=r=>r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||r==36||r==95||r>=192&&r!=215&&r!=247,_=[],s=(r,o=32,t,e=r.charCodeAt(0),m=r.length,R=_[e],Y=r.toUpperCase()!==r)=>_[e]=(L,U,d,Z=C)=>(d?r==d:(m<2||n.substr(C,m)==r)&&(d=r))&&U<o&&!(Y&&h.id(n.charCodeAt(C+m)))&&(C+=m,t(L)||(C=Z,!R&&P()))||R?.(L,U,d),E=(r,o,t=!1)=>s(r,o,(e,m)=>e&&(m=u(o-(t?.5:0)))&&[r,e,m]),A=(r,o,t)=>s(r,o,e=>t?e&&[r,e]:!e&&(e=u(o-.5))&&[r,e]),I=(r,o,t)=>{s(r,o,(e,m)=>(m=u(o),e?.[0]!==r&&(e=[r,e||null]),m?.[0]===r?e.push(...m.slice(1)):e.push(m||null),e))},X=(r,o)=>s(r[0],o,t=>!t&&[r,u(0,r.charCodeAt(1))]),T=(r,o)=>s(r[0],o,t=>t&&[r,t,u(0,r.charCodeAt(1))||null]),Q=h;var w=(r,o)=>[,(r=+N(t=>t===46||t>=48&&t<=57||(t===69||t===101?2:0)))!=r?P():r];_[46]=r=>!r&&w();for(let r=48;r<=57;r++)_[r]=o=>o?P():w();var rr={n:`
`,r:"\r",t:"	",b:"\b",f:"\f",v:"\v"},c=r=>(o,t,e="")=>(o&&P("Unexpected string"),B(),N(m=>m-r&&(m===92?(e+=rr[n[C+1]]||n[C+1],2):(e+=n[C],1))),B()||P("Bad string"),[,e]);_[34]=c(34);_[39]=c(39);var i=r=>Array.isArray(r)?r[0]?k[r[0]].call(...r):()=>r[1]:i.id(r),Ar=i.id=r=>o=>o?.[r],k={},p=(r,o,t=k[r])=>k[r]=(...e)=>o(...e)||t?.(...e),f=(r,o,t,e,m)=>r[0]==="()"&&r.length==2?f(r[1],o,t):typeof r=="string"?R=>o(R,r,R):r[0]==="."?(e=i(r[1]),m=r[2],R=>o(e(R),m,R)):r[0]==="[]"&&r.length===3?(e=i(r[1]),m=i(r[2]),R=>o(e(R),m(R),R)):t?(r=i(r),R=>o([r(R)],0,R)):()=>P("Bad left value"),J=i;T("()",170);p("()",(r,o,t)=>o!==void 0&&(t=o?o[0]===","?(o=o.slice(1).map(e=>e?i(e):err()),e=>o.map(m=>m(e))):(o=i(o),e=>[o(e)]):()=>[],f(r,(e,m,R)=>e[m](...t(R)),!0)));T("[]",170);p("[]",(r,o)=>o?(r=i(r),o=i(o),t=>r(t)[o(t)]):err());E(".",170);p(".",(r,o)=>(r=i(r),o=o[0]?o:o[1],t=>r(t)[o]));X("()",170);p("()",(r,o)=>o===void 0&&(!r&&P("Empty ()"),i(r)));var q=(...r)=>(r=r.map(i),o=>r.map(t=>t(o)).pop());I(",",10),p(",",q);I(";",5,!0),p(";",q);E("=",20,!0);p("=",(r,o)=>(o=i(o),f(r,(t,e,m)=>t[e]=o(m))));E("*",120),p("*",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)*o(t)));E("/",120),p("/",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)/o(t)));E("%",120),p("%",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)%o(t)));E("*=",20,!0);p("*=",(r,o)=>(o=i(o),f(r,(t,e,m)=>t[e]*=o(m))));E("/=",20,!0);p("/=",(r,o)=>(o=i(o),f(r,(t,e,m)=>t[e]/=o(m))));E("%=",20,!0);p("%=",(r,o)=>(o=i(o),f(r,(t,e,m)=>t[e]%=o(m))));E("+",110),p("+",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)+o(t)));E("-",110),p("-",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)-o(t)));A("+",140),p("+",(r,o)=>!o&&(r=i(r),t=>+r(t)));A("-",140),p("-",(r,o)=>!o&&(r=i(r),t=>-r(t)));E("+=",20,!0);p("+=",(r,o)=>(o=i(o),f(r,(t,e,m)=>t[e]+=o(m))));E("-=",20,!0);p("-=",(r,o)=>(o=i(o),f(r,(t,e,m)=>t[e]-=o(m))));s("++",150,r=>r?["++",r,null]:["++",u(149)]);p("++",(r,o)=>f(r,o===null?(t,e)=>t[e]++:(t,e)=>++t[e]));s("--",150,r=>r?["--",r,null]:["--",u(149)]);p("--",(r,o)=>f(r,o===null?(t,e)=>t[e]--:(t,e)=>--t[e]));A("~",140),p("~",(r,o)=>!o&&(r=i(r),t=>~r(t)));E("|",50),p("|",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)|o(t)));E("&",70),p("&",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)&o(t)));E("^",60),p("^",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)^o(t)));A("!",140),p("!",(r,o)=>!o&&(r=i(r),t=>!r(t)));E("||",30);p("||",(r,o)=>(r=i(r),o=i(o),t=>r(t)||o(t)));E("&&",40);p("&&",(r,o)=>(r=i(r),o=i(o),t=>r(t)&&o(t)));E("==",80),p("==",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)==o(t)));E("!=",80),p("!=",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)!=o(t)));E(">",90),p(">",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)>o(t)));E("<",90),p("<",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)<o(t)));E(">=",90),p(">=",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)>=o(t)));E("<=",90),p("<=",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)<=o(t)));E(">>",100),p(">>",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)>>o(t)));E("<<",100),p("<<",(r,o)=>o&&(r=i(r),o=i(o),t=>r(t)<<o(t)));E(">>=",20,!0);p(">>=",(r,o)=>(o=i(o),prop(r,(t,e,m)=>t[e]>>=o(m))));E("<<=",20,!0);p("<<=",(r,o)=>(o=i(o),prop(r,(t,e,m)=>t[e]<<=o(m))));function S(r){if(!r)return"";if(Array.isArray(r)){let[o,...t]=r;return o?o=="[]"||o=="{}"||o=="()"?(t.length>1?S(t.shift()):"")+o[0]+S(t[0])+o[1]:t.length===1?o+S(t[0]):t.length===2?S(t[0])+(o==="."?o:" "+o+" ")+S(t[1]):t.filter(Boolean).map(e=>S(e)).join(o+`
`):JSON.stringify(t[0])}return r}var Xo=r=>J(Q(r));export{T as access,E as binary,i as compile,Xo as default,X as group,I as nary,p as operator,h as parse,S as stringify,s as token,A as unary};
