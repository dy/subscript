let r,e,t=t=>(r=0,e=t,t=i(),e[r]?a():t||""),a=(t="Bad syntax",a=e.slice(0,r).split("\n"),s=a.pop())=>{let i=e.slice(r-108,r).split("\n").pop(),n=e.slice(r,r+108).split("\n").shift();throw EvalError(`${t} at ${a.length}:${s.length} \`${r>=108?"…":""}${i}▶${n}\``,"font-weight: bold")},s=(t=1,a=r,s)=>{if("number"==typeof t)r+=t;else for(;s=t(e.charCodeAt(r));)r+=s;return e.slice(a,r)},i=(e=0,s,i,n,l,p)=>{for(;(i=t.space())&&(l=((p=o[i])&&p(n,e))??(!n&&t.id()));)n=l;return s&&(i==s?r++:a()),n},n=r=>r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||36==r||95==r||r>=192&&215!=r&&247!=r;t.id=()=>s(n);let l=t.space=t=>{for(;(t=e.charCodeAt(r))<=32;)r++;return t},o=[],p=(t,a=32,s,i=t.charCodeAt(0),l=t.length,p=o[i],c=t.toUpperCase()!==t)=>o[i]=(i,o,d=r)=>o<a&&(l<2||e.substr(r,l)==t)&&(!c||!n(e.charCodeAt(r+l)))&&(r+=l,s(i,o))||(r=d,p?.(i,o)),c=(r,e,t=!1)=>p(r,e,((a,s)=>a&&(s=i(e-(t?.5:0)))&&[r,a,s])),d=(r,e,t)=>p(r,e,(a=>t?a&&[r,a]:!a&&(a=i(e-.5))&&[r,a])),f=(r,e)=>{p(r,e,((t,a)=>(a=i(e),(!t||t[0]!==r)&&(t=[r,t]),t.push(a),t)))},h=(r,e)=>p(r[0],e,(e=>!e&&[r,i(0,r.charCodeAt(1))])),m=(r,e)=>p(r[0],e,(e=>e&&[r[0],e,i(0,r.charCodeAt(1))]));const A=r=>Array.isArray(r)?r[0]?u[r[0]](...r.slice(1)):()=>r[1]:A.id(r);A.id=r=>e=>e?.[r];const u={},y=(r,e,t=u[r])=>u[r]=(...r)=>e(...r)||t&&t(...r),C=(r,e,t,s,i)=>"()"===r[0]?C(r[1],e,t):"string"==typeof r?t=>e(t,r,t):"."===r[0]?(s=A(r[1]),i=r[2],r=>e(s(r),i,r)):"["===r[0]?(s=A(r[1]),i=A(r[2]),r=>e(s(r),i(r),r)):t?(r=A(r),t=>e([r(t)],0,t)):()=>a("Bad left value"),b=r=>r?a():[,(r=+s((r=>46===r||r>=48&&r<=57||(69===r||101===r?2:0))))!=r?a():r];o[46]=r=>!r&&b();for(let r=48;r<=57;r++)o[r]=b;const g={n:"\n",r:"\r",t:"\t",b:"\b",f:"\f",v:"\v"},$=t=>(i,n,l="")=>{for(i&&a("Unexpected string"),s();(n=e.charCodeAt(r))-t;)92===n?(s(),n=s(),l+=g[n]||n):l+=s();return s()||a("Bad string"),[,l]};o[34]=$(34),o[39]=$(39),m("()",17),y("(",((r,e,t)=>(t=e?","===e[0]?(e=e.slice(1).map((r=>r?A(r):err())),r=>e.map((e=>e(r)))):(e=A(e),r=>[e(r)]):()=>[],C(r,((r,e,a)=>r[e](...t(a))),!0)))),m("[]",17),y("[",((r,e)=>e?(r=A(r),e=A(e),t=>r(t)[e(t)]):err())),c(".",17),y(".",((r,e)=>(r=A(r),e=e[0]?e:e[1],t=>r(t)[e]))),h("()",17),y("()",(r=>(!r&&a("Empty ()"),A(r))));const v=(...r)=>(r=r.map(A),e=>r.map((r=>r(e))).pop());f(",",1),y(",",v),f(";",1),y(";",v),c("*",12),y("*",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)*e(t)))),c("/",12),y("/",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)/e(t)))),c("%",12),y("%",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)%e(t)))),c("*=",2,!0),y("*=",((r,e)=>(e=A(e),C(r,((r,t,a)=>r[t]*=e(a)))))),c("/=",2,!0),y("/=",((r,e)=>(e=A(e),C(r,((r,t,a)=>r[t]/=e(a)))))),c("%=",2,!0),y("%=",((r,e)=>(e=A(e),C(r,((r,t,a)=>r[t]%=e(a)))))),d("+",14),y("+",((r,e)=>!e&&(r=A(r),e=>+r(e)))),d("-",14),y("-",((r,e)=>!e&&(r=A(r),e=>-r(e)))),c("+",11),y("+",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)+e(t)))),c("-",11),y("-",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)-e(t)))),c("+=",2,!0),y("+=",((r,e)=>(e=A(e),C(r,((r,t,a)=>r[t]+=e(a)))))),c("-=",2,!0),y("-=",((r,e)=>(e=A(e),C(r,((r,t,a)=>r[t]-=e(a)))))),p("++",15,(r=>r?["++-",r]:["++",i(14)])),y("++",(r=>C(r,((r,e,t)=>++r[e])))),y("++-",(r=>C(r,((r,e,t)=>r[e]++)))),p("--",15,(r=>r?["--+",r]:["--",i(14)])),y("--",(r=>C(r,((r,e,t)=>--r[e])))),y("--+",(r=>C(r,((r,e,t)=>r[e]--)))),d("~",14),y("~",((r,e)=>!e&&(r=A(r),e=>~r(e)))),c("|",5),y("|",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)|e(t)))),c("&",7),y("&",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)&e(t)))),c("^",6),y("^",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)^e(t)))),c(">>",10),y(">>",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)>>e(t)))),c("<<",10),y("<<",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)<<e(t)))),c("==",8),y("==",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)==e(t)))),c("!=",8),y("!=",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)!=e(t)))),c(">",8),y(">",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)>e(t)))),c("<",8),y("<",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)<e(t)))),c(">=",8),y(">=",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)>=e(t)))),c("<=",8),y("<=",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)<=e(t)))),d("!",14),y("!",((r,e)=>!e&&(r=A(r),e=>!r(e)))),c("||",3),y("||",((r,e)=>(r=A(r),e=A(e),t=>r(t)||e(t)))),c("&&",4),y("&&",((r,e)=>(r=A(r),e=A(e),t=>r(t)&&e(t)))),c("=",2,!0),y("=",((r,e)=>(e=A(e),C(r,((r,t,a)=>r[t]=e(a))))));var E=r=>A(t(r));p("/*",20,((t,a)=>(s((t=>42!==t&&47!==e.charCodeAt(r+1))),s(2),t||i(a)||[]))),p("//",20,((r,e)=>(s((r=>r>=32)),r||i(e)||[""]))),c("**",13,!0),y("**",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)**e(t)))),c("in",9),y("in",((r,e)=>e&&(r=A(r),e=A(e),t=>r(t)in e(t)))),p("?",2,((r,e,t)=>r&&(e=i(2,58))&&["?",r,e,i(3)])),y("?",((r,e,t)=>(r=A(r),e=A(e),t=A(t),a=>r(a)?e(a):t(a)))),p("true",20,(r=>r?err():[,!0])),p("false",20,(r=>r?err():[,!1])),h("[]",20),y("[]",((r,e)=>r?","===r[0]?(r=r.slice(1).map(A),e=>r.map((r=>r(e)))):(r=A(r),e=>[r(e)]):()=>[])),h("{}",20),y("{}",((r,e)=>r?","===r[0]?(r=r.slice(1).map(A),e=>Object.fromEntries(r.map((r=>r(e))))):":"===r[0]?(r=A(r),e=>Object.fromEntries([r(e)])):(e=A(r),t=>({[r]:e(t)})):()=>({}))),c(":",2,!0),y(":",((r,e)=>(e=A(e),r=Array.isArray(r)?A(r):(r=>r).bind(0,r),t=>[r(t),e(t)]))),p("?.",17,(r=>r&&["?.",r])),y("?.",(r=>(r=A(r),e=>r(e)||(()=>{})))),p("?.",17,((r,e)=>r&&!(e=i(17))?.map&&["?.",r,e])),y("?.",((r,e)=>e&&(r=A(r),t=>r(t)?.[e]))),y("(",((r,e,t,a,s,i)=>"?."===r[0]&&(r[2]||Array.isArray(r[1]))&&(a=e?","===e[0]?(e=e.slice(1).map(A),r=>e.map((e=>e(r)))):(e=A(e),r=>[e(r)]):()=>[],!r[2]&&(r=r[1]),s="["===r[0]?A(r[2]):()=>r[2],t=A(r[1]),r=>t(r)?.[s(r)]?.(...a(r))))),p("null",20,(r=>r?a():[,null]));export{m as access,c as binary,A as compile,e as cur,E as default,a as err,i as expr,h as group,r as idx,n as isId,o as lookup,f as nary,y as operator,u as operators,t as parse,C as prop,s as skip,l as space,p as token,d as unary};