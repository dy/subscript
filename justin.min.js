var e,r,o=e=>Array.isArray(e)&&("string"==typeof e[0]||o(e[0])),t=(e,r={},n,p)=>o(e)?("string"==typeof(n=e[0])&&(p=a[n]),"function"!=typeof(n=p||t(n,r))?n:n.call(...e.map((e=>t(e,r))))):e&&"string"==typeof e?'"'===e[0]?e.slice(1,-1):"@"===e[0]?e.slice(1):e in r?r[e]:e:e,a=t.operator={"!":e=>!e,"++":e=>++e,"--":e=>--e,".":(...e)=>e.reduce(((e,r)=>e&&e[r])),"%":(...e)=>e.reduce(((e,r)=>e%r)),"/":(...e)=>e.reduce(((e,r)=>e/r)),"*":(...e)=>e.reduce(((e,r)=>e*r)),"+":(...e)=>e.reduce(((e,r)=>e+r)),"-":(...e)=>e.length<2?-e:e.reduce(((e,r)=>e-r)),">>>":(e,r)=>e>>>r,">>":(e,r)=>e>>r,"<<":(e,r)=>e<<r,">=":(e,r)=>e>=r,">":(e,r)=>e>r,"<=":(e,r)=>e<=r,"<":(e,r)=>e<r,"!=":(e,r)=>e!=r,"==":(e,r)=>e==r,"&":(e,r)=>e&r,"^":(e,r)=>e^r,"|":(e,r)=>e|r,"&&":(...e)=>e.every(Boolean),"||":(...e)=>e.some(Boolean),",":(...e)=>e.reduce(((e,r)=>r))},n=t,p=(o,t)=>(r=o,e=0,t=f(),e<r.length?s():t),s=(o="Bad syntax")=>{throw Error(o+" `"+r[e]+"` at "+e)},i=(o=1,t=e)=>{if("number"==typeof o)e+=o;else for(;o(l());)e++;return r.slice(t,e)||u},l=(o=0)=>r.charCodeAt(e+o),c=(o=1)=>r.substr(e,o),u="",f=(r=0,o,t=p.space(),a,n=e,i=0,c)=>{for(;n===e&&i<p.token.length;)a=p.token[i++](t);for(i=Math.max(0|y[t=p.space()],r);i<p.operator.length&&!(t===o||i<r);)(c=p.operator[i++](a,t,i,o))&&(c.indexOf(u)>=0&&s("Bad expression"),a=c,i=Math.max(0|y[t=p.space()],r));return!r&&o&&l()!=o&&s("Unclosed paren"),a},d=(p.space=r=>{for(;(r=l())<=32;)e++;return r},p.token=[e=>(e=i((e=>e>47&&e<58||46===e)))?((69===l()||101===l())&&(e+=i(2)+i((e=>e>=48&&e<=57))),isNaN(e=parseFloat(e))?s("Bad number"):e):u,(e,r)=>34===e?i()+i((r=>r-e))+i():u,r=>40===r?(++e,r=f(0,41),++e,r===u?s():r):u,e=>i((e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e))],e=>(r,o,t,a,n,s,l)=>{if(r!==u&&(s=0|e(o))){n=[l=c(s),r];do{i(s),n.push(f(t,a))}while(p.space()==o&&c(s)==l);return n}}),h=(e,r=!1)=>r?(r,o,t,a,n)=>r!==u&&(n=0|e(o))&&[i(n),r]:(r,o,t,a,n)=>r===u&&(n=0|e(o))&&[i(n),f(t-1,a)],y=(p.operator=[d((e=>44==e)),d((e=>124==e&&l(1)==e&&2)),d((e=>38==e&&l(1)==e&&2)),d((e=>124==e)),d((e=>94==e)),d((e=>38==e)),d((e=>(61==e||33==e)&&61==l(1)&&(l(1)==l(2)?3:2))),d((e=>(62==e||60==e)&&e!=l(1))),d((e=>(60==e||62==e)&&e==l(1)&&(e==l(2)?3:2))),d((e=>(43==e||45==e)&&l(1)!=e)),d((e=>42==e&&42!=l(1)||47==e||37==e)),h((e=>(43==e||45==e)&&l(1)==e&&2),!0),h((e=>(43==e||45==e||33==e)&&(l(1)==e?2:1))),(r,o,t,a,n)=>46==o?[i(),r,"string"==typeof(n=f(t,a))?'"'+n+'"':n]:91==o?(e++,r=[".",r,f(0,93)],e++,r):40==o?(e++,n=f(0,41),e++,Array.isArray(n)&&","===n[0]?(n[0]=r,n):n===u?[r]:[r,n]):u],[]);y[44]=0,y[124]=1,y[38]=2,y[94]=4,y[61]=y[33]=6,y[60]=y[62]=7,y[43]=y[45]=9,y[42]=y[47]=y[37]=10,y[46]=y[91]=y[40]=13;var g=p,v=e=>(e="string"==typeof e?g(e):e,r=>n(e,r));p.token.splice(3,0,(e=>!(116!==e||"true"!==c(4)||!i(4))||(102!==e||"false"!==c(5)||!i(5))&&(110===e&&"null"===c(4)&&i(4)?null:void(117===e&&"undefined"===c(9)&&i(9))))),p.token[1]=(e,r,o,t)=>{if(34===e||39===e){for(r=c(),i(),t="";(o=l())-e;)92===o?(i(),t+=k[c()]||c()):t+=c(),i();return i(),r+t+r}};var k={n:"\n",r:"\r",t:"\t",b:"\b",f:"\f",v:"\v"};t.operator["**"]=(...e)=>e.reduceRight(((e,r)=>Math.pow(r,e))),p.operator.splice(p.operator.length-3,0,d((e=>42===e&&l(1)===e&&2))),p.operator.splice(p.operator.length-2,0,h((e=>126===e))),t.operator["~"]=e=>~e,t.operator["?:"]=(e,r,o)=>e?r:o,p.operator.splice(1,0,((e,r,o,t)=>{let a,n;if(63===r&&(e===u&&err("Bad expression"),i(),p.space(),a=f(-1,58),58===l()))return i(),p.space(),n=f(),["?:",e,a,n]})),p.space=e=>{for(;(e=l())<=32;)i(),47===l()&&(42===l(1)?(i(2),i((e=>42!==e&&47!==l(1))),i(2)):47===l(1)&&(i(2),i((e=>e>=32))));return e},t.operator.in=(e,r)=>e in r,p.operator.splice(6,0,((e,r,o,t)=>"in"===c(2)&&[i(2),'"'+e+'"',f(o,t)])),t.operator["["]=(...e)=>Array(...e),p.token.unshift(((e,r,o)=>91===e&&(i(),r=(o=f(0,93))===u?["["]:","===o[0]?(o[0]="[",o):["[",o],i(),r))),p.token.unshift(((e,r)=>123===e?(i(),r=m(["{",f(0,125)]),i(),r):null)),p.operator.splice(4,0,d((e=>58===e))),t.operator["{"]=(...e)=>Object.fromEntries(e),t.operator[":"]=(e,r)=>[e,r];var m=(e,r)=>(e[1]===u?r=[]:":"==e[1][0]?r=[e[1]]:","==e[1][0]&&(r=e[1].slice(1)),["{",...r]);export{v as default,t as evaluate,p as parse};