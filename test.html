<script type="module">
  import test, {is} from './lib/test.js'
  import {parse} from '../subscript.js'

  test('parse: basic', t => {
    is(parse('0 + 1 + 2'), ['+', 0, 1, 2])
    is(parse('0 + 1 - 2'), ['+', 0, ['-',1, 2]])
    is(parse('0 + 1 - 2 * 3'), ['+', 0, ['-',1, ['*', 2, 3]]])
    is(parse('0 - 1 + 2'), ['+', ['-',0, 1], 2])
    is(parse('1 * 2 - 3'), ['-', ['*',1,2], 3])
    is(parse('1 + a.b + 3.5'), ['+', 1, ['.', 'a', 'b'], 3.5])
    is(parse('1 + (a.b + 3.5)'), ['+', 1, ['+', ['.', 'a', 'b'], 3.5]])
    is(parse('1 + x(a.b + 3.5)'), ['+', 1, ['x', ['+', ['.', 'a','b'], 3.5]]])
    is(parse('1 + x(a[b] + 3.5)'), ['+', 1, ['x', ['+', ['.', 'a','b'], 3.5]]])
  })
  test('parse: signs', t => {
    is(parse('+-1'),['+',['-',1]])
    is(parse('1+-1'),['+',1,['-',1]])
    is(parse('+1-+-1'),['-',['+',1],['+',['-',1]]])
    is(parse('+1-+-a[1]'),['-',['+',1],['+',['-',['.','a',1]]]])
    is(parse('+1 + +2'),['+',['+',1],['+',2]])
    is(parse('+1 + -2'),['+',['+',1],['-',2]])
    is(parse('+1 -+2'),['-',['+',1],['+',2]])
    is(parse('1 -2'),['-',1,2])
    is(parse('+1 -2'),['-',['+',1],2])
    is(parse('-1 +2'),['+',['-',1],2])
    is(parse('1 * -1'),['*',1,['-',1]])
  })
  test('parse: unaries', t => {
    is(parse('-2'),['-',2])
    is(parse('+-2'),['+',['-',2]])
    // TODO
    // is(parse('-+-2'),['-',['+',['-',2]]])
    // is(parse('-+~2'),['-',['+',['~',2]]])
    is(parse('1-+-2'),['-',1,['+',['-',2]]])
    is(parse('1-+~2'),['-',1,['+',['~',2]]])
  })
  // console.log(parse('+1 * (a.b - 3.5) - "asdf" || x.y.z(123 + c[456]) + n'))
  // console.log(parse('[1,2,3]'))
</script>
