let e,t,r=r=>(e=0,t=r,r=s(),t[e]?a():r||""),a=(r="Bad syntax",a=t[e],n=t.slice(0,e).split("\n"),s=n.pop())=>{throw SyntaxError(`${r} \`${a}\` at ${n.length}:${s.length}`)},n=(r=1,a=e,n)=>{if("number"==typeof r)e+=r;else for(;n=r(t.charCodeAt(e));)e+=n;return t.slice(a,e)},s=(t=0,n,s,l,o,y)=>{for(;(s=r.space())&&(o=((y=h[s])&&y(l,t))??(!l&&r.id()));)l=o;return n&&(s==n?e++:a()),l},l=e=>e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||36==e||95==e||e>=192&&215!=e&&247!=e;r.space=r=>{for(;(r=t.charCodeAt(e))<=32;)e++;return r},r.id=e=>n(l);let h=[];r.set=(r,a=32,n,s=r.charCodeAt(0),o=r.length,y=h[s],i=r.toUpperCase()!==r)=>h[s]=(s,h,c=e)=>h<a&&(o<2||t.substr(e,o)==r)&&(!i||!l(t.charCodeAt(e+o)))&&(e+=o,n(s,h))||(e=c,y?.(s,h)),r.binary=(e,t,a)=>r.set(e,t,((r,n)=>r&&(n=s(t-!!a))&&[e,r,n])),r.unary=(e,t,a)=>r.set(e,t,(r=>!r&&(r=s(t-1))&&[e,r])),r.nary=(e,t)=>r.set(e,t,((r,a)=>r&&(a=s(t))&&(r[0]===e&&r[2]?(r.push(a),r):[e,r,a])));const o=e=>Array.isArray(e)?y[e[0]](...e.slice(1)):t=>t?.[e],y={};o.set=(e,t,r=y[e])=>y[e]=(...e)=>t(...e)||r&&r(...e),o.binary=(e,t)=>o.set(e,((e,r)=>r&&(e=o(e),r=o(r),e.length||r.length?a=>t(e(a),r(a)):(e=t(e(),r()),()=>e)))),o.unary=(e,t)=>o.set(e,((e,r)=>!r&&((e=o(e)).length?r=>t(e(r)):(e=t(e()),()=>e)))),o.nary=(e,t)=>o.set(e,((...e)=>(e=e.map(o),r=>t(...e.map((e=>e(r)))))));const i=e=>(e=r(e),t=>(e.call?e:e=o(e))(t)),c=i.set=(e,t,a)=>a[0]||a[1]?(t?r.set(e,t,a[0]):h[e.charCodeAt(0)||1]=a[0],o.set(e,a[1])):a.length?a.length>1?(r.binary(e,Math.abs(t),t<0),o.binary(e,a)):(r.unary(e,t),o.unary(e,a)):(r.nary(e,t),o.nary(e,a)),p=e=>e?a():["",(e=+n((e=>46===e||e>=48&&e<=57||(69===e||101===e?2:0))))!=e?a():e],u=(e,t,r,a)=>[e,t,[r=>r?["++"===e?"-":"+",[e,r],["",1]]:[e,s(t-1)],a=(e,t)=>"("===e[0]?a(e[1]):"."===e[0]?(t=e[2],e=o(e[1]),a=>r(e(a),t)):"["===e[0]?([,e,t]=e,e=o(e),t=o(t),a=>r(e(a),t(a))):t=>r(t,e)]],g=["",,[,e=>()=>e],'"',,[e=>e?a():["",(n()+n((e=>e-34?1:0))+(n()||a("Bad string"))).slice(1,-1)]],".",,[e=>!e&&p()],...Array(10).fill(0).flatMap(((e,t)=>[""+t,0,[p]])),",",1,(...e)=>e[e.length-1],"||",4,(...e)=>{let t,r=0;for(;!t&&r<e.length;)t=e[r++];return t},"&&",5,(...e)=>{let t=0,r=!0;for(;r&&t<e.length;)r=e[t++];return r},"+",12,(e,t)=>e+t,"-",12,(e,t)=>e-t,"*",13,(e,t)=>e*t,"/",13,(e,t)=>e/t,"%",13,(e,t)=>e%t,"|",6,(e,t)=>e|t,"&",8,(e,t)=>e&t,"^",7,(e,t)=>e^t,"==",9,(e,t)=>e==t,"!=",9,(e,t)=>e!=t,">",10,(e,t)=>e>t,">=",10,(e,t)=>e>=t,"<",10,(e,t)=>e<t,"<=",10,(e,t)=>e<=t,">>",11,(e,t)=>e>>t,">>>",11,(e,t)=>e>>>t,"<<",11,(e,t)=>e<<t,"+",15,e=>+e,"-",15,e=>-e,"!",15,e=>!e,...u("++",15,((e,t)=>++e[t])),...u("--",15,((e,t)=>--e[t])),"[",18,[e=>e&&["[",e,s(0,93)||a()],(e,t)=>t&&(e=o(e),t=o(t),r=>e(r)[t(r)])],".",18,[(e,t)=>e&&(t=s(18))&&[".",e,t],(e,t)=>(e=o(e),t=t[0]?t:t[1],r=>e(r)[t])],"(",18,[e=>!e&&["(",s(0,41)||a()],o],"(",18,[e=>e&&["(",e,s(0,41)||""],(e,t,r,a)=>null!=t&&(a=""==t?()=>[]:","===t[0]?(t=t.slice(1).map(o),e=>t.map((t=>t(e)))):(t=o(t),e=>[t(e)]),"."===e[0]?(r=e[2],e=o(e[1]),t=>e(t)[r](...a(t))):"["===e[0]?(r=o(e[2]),e=o(e[1]),t=>e(t)[r(t)](...a(t))):(e=o(e),t=>e(t)(...a(t))))]];for(;g[2];)c(...g.splice(0,3));export{o as compile,i as default,r as parse};