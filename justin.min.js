export const operators=[{"(":(...e)=>e(...args),"[":(...e)=>e.reduce(((e,r)=>e?e[r]:e)),".":(...e)=>e.reduce(((e,r)=>e?e[r]:e))},{"!":e=>!e,"+":e=>+e,"-":e=>-e,"++":e=>++e,"--":e=>--e},{"%":(...e)=>e.reduce(((e,r)=>e%r)),"/":(...e)=>e.reduce(((e,r)=>e/r)),"*":(...e)=>e.reduce(((e,r)=>e*r))},{"+":(...e)=>e.reduce(((e,r)=>e+r)),"-":(...e)=>e.reduce(((e,r)=>e-r))},{">>>":(e,r)=>e>>>r,">>":(e,r)=>e>>r,"<<":(e,r)=>e<<r},{">=":(e,r)=>e>=r,">":(e,r)=>e>r,"<=":(e,r)=>e<=r,"<":(e,r)=>e<r},{"!=":(e,r)=>e!=r,"==":(e,r)=>e==r},{"&":(e,r)=>e&r},{"^":(e,r)=>e^r},{"|":(e,r)=>e|r},{"&&":(...e)=>e.every(Boolean)},{"||":(...e)=>e.some(Boolean)},{",":(...e)=>e.reduce(((e,r)=>r))}],operator=(e,r,o,s)=>{if(e&&"string"==typeof e&&!quotes[e[0]])for(s=operators.length;s--;)if((o=operators[s][e])&&1==r?o.length==r:o)return o},literals={true:!0,false:!1,null:null,undefined:void 0},blocks={"(":")","[":"]"},quotes={'"':'"'},comments={},transforms={"(":e=>e.length<2?e[1]:e.slice(1).reduce(((e,r)=>[e].concat(r?","==r[0]?r.slice(1):[r]:[]))),".":e=>[e[0],e[1],...e.slice(2).map((e=>"string"==typeof e?`"${e}"`:e))]},transform=(e,r)=>(r=isnode(e)&&transforms[e[0]])?r(e):e,isnode=e=>Array.isArray(e)&&e.length&&e[0],space=" \r\n\t",parse=(e,r=0)=>{const o=(n,a="",l,i,p,c,u,f=[])=>{const d=e=>{""!==a&&f.push(l?parseFloat(a):a in literals?literals[a]:a),e&&f.push(e),l=a=i=""};for(;r<=e.length;a+=i)if(c=(p=(i=e[r++])+e[r])+e[r+1],!l||"e"!=i&&"E"!=i)if(space.includes(i))d();else if(u=comments[p]||comments[i])d(),s(e,u);else if(u=quotes[c]||quotes[p]||quotes[i])a=i+e.slice(r,s(e,u)),d();else if(u=blocks[i])d(i),f.push(o(u));else if(!a&&i>="0"&&i<="9"||"."==i&&e[r]>="0"&&e[r]<="9")l=1;else{if(i==n)return d(),t(f);(operator(i=c)||operator(i=p)||operator(i=i[0]))&&(r+=i.length-1,(i.toLowerCase()==i.toUpperCase()||!a&&space.includes(e[r]))&&d(i))}else i+=e[r++]},s=(e,o,s)=>r=(r=e.indexOf(o,r))<0?e.length:r+o.length,t=e=>{if(!e.length)return;let r,o,s,t,n,a,l;const i=()=>{return~s&&(e[s]=(r=e[s],(o=isnode(r)&&transforms[r[0]])?o(r):r),s=-1);var r,o};for(r of operators){for(s=-1,o=1;o<e.length;)t=e[o-2],a=e[o-1],n=e[o],l="string"==typeof a&&r[a],l&&!operator(n)&&o>1&&!operator(t)?1==r[a].length?(i(),o++):s==o-2&&t[0]==a?(t.push(n),e.splice(o-1,2)):(i(),e.splice(s=o-2,3,[a,e[s],n])):l&&!operator(n)?(e.splice(s=o-1,2,[a,n]),o--):(i(),o++);i()}return e.length>1?e:e[0]};return e=o()},evaluate=(e,r={})=>isnode(e)?(isnode(e[0])?evaluate(e[0]):"string"==typeof e[0]?r[e[0]]||operator(e[0],e.length-1):e[0])(...e.slice(1).map((e=>evaluate(e,r)))):"string"==typeof e?quotes[e[0]]?e.slice(1,-1):r[e]:e;export default e=>(e="string"==typeof e?parse(e):e,r=>evaluate(e,r));operators.splice(2,0,{"**":(...e)=>e.reduceRight(((e,r)=>Math.pow(r,e)))}),operators[1]["~"]=e=>~e,operators[operators.length-1][";"]=operators[operators.length-1][","],operators.splice(operators.length-2,0,{":":(e,r)=>[e,r],"?":(e,r)=>e??r,"?:":(e,r,o)=>e?r:o}),transforms[":"]=e=>"?"==e[1][0]?["?:",e[1][1],e[1][2],e[2]]:e,blocks["{"]="}",comments["/*"]="*/",comments["//"]="\n",operators[5].in=(e,r)=>e in r,transforms.in=e=>(e[1]=`"${e[1]}"`,e),blocks["{"]="}",operators.unshift({"[":e=>Array(...e),"{":e=>Object.fromEntries(e)}),transforms["["]=e=>e.length>2?e:void 0===e[1]?[Array]:[Array].concat(isnode(e[1])?e[1].slice(1).reduce(((e,r)=>e.push(...isnode(r)&&","==r[0]?(r[0]=void 0,r):[r])&&e),[]):e[1]),transforms["{"]=(e,r)=>void 0===e[1]?{}:(r=(r=":"==e[1][0]?[e[1].slice(1)]:e[1].slice(1).map((e=>e.slice(1)))).map((e=>quotes[e[0][0]]?[e[0].slice(1,-1),e[1]]:e)),Object.fromEntries(r));
